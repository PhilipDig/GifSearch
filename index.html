<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>GIF Search</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB"
        crossorigin="anonymous">

    <!-- Apply bootswatch theme -->
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">

    <!-- Apply my CSS -->
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>

    <section>
        <div class="row">
            <div class="col-sm-12 col-md-4">
                <h4>Trending GIF topics:</h4>

                <div id="trendingButtons" class="btn-group-toggle" data-toggle="buttons"></div>

                <!-- TODO BONUS idea if have extra time 
                    <h4 style="margin-top: 15px">Your favorite GIF topics:</h4>

                <div id="favoriteButtons" class="btn-group-toggle" data-toggle="buttons"></div> -->

                <form>
                    <div class="form-group addGifTopic">
                        <label for="addGifTag">Add a new GIF topic:</label>
                        <input type="text" class="form-control" id="addGifTopic">
                    </div>
                    <button type="submit" class="btn btn-info submitButton">Submit</button>
                </form>
            </div>
            <div class="col-sm-12 col-md-8" id="displayedGIFs">
            </div>
        </div>
    </section>




    <!-- Get jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

    <!-- Get Bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>

    <!-- Run my script -->
    <script>

        // Scrape topics from 10 trending gif titles for topics, exclude "GIF by ..." string
        // NOTE: initial 10 topics are just placeholders if the proceeding trending request fails
        let topics = ["sports", "emoji", "meme", "action", "sticker", "fail", "sleep", "smile", "dance", "gift"]

        // Function to redraw topics from array
        function displayTopicButtons() {

            $("#trendingButtons").empty()

            topics.forEach(function (gifTitle) {
                $("#trendingButtons").append($(`<label class="btn btn-primary gifButton" value="${gifTitle}"><input type="radio" autocomplete="off">${gifTitle}</label>`))
            })
        }

        displayTopicButtons()

        $.ajax({
            url: "https://api.giphy.com/v1/gifs/trending?api_key=qQTSneMABDp0TnSFY1GRlDzUoivH4fa5&limit=10&rating=PG-13",
            method: "GET"
        }).then(function (response) {

            // If response status is successful
            if (response.meta.status == 200) {

                // remove intial topics
                topics = []

                response.data.forEach(function (gifObject) {

                    let title = gifObject.title

                    // Remove boiler plate from title and add it to array for button labels
                    let boilerPlateIndex = title.search("GIF")

                    // If title does not contain GIF, the whole title with by shown
                    if (boilerPlateIndex != -1) {

                        title = title.slice(0, boilerPlateIndex).trim()
                    }

                    // Add title to topic array
                    topics.push(title)
                })

                // Populate trending GIF topic buttons
                displayTopicButtons()

            } else {
                alert("Trending GIF topic search failed: " + response.meta.message)
            }
        });

        // Display 10 GIFs with the selected topic when user clicks the button
        $(document.body).on("click", ".gifButton", function () {

            $.ajax({
                url: `https://api.giphy.com/v1/gifs/search?api_key=qQTSneMABDp0TnSFY1GRlDzUoivH4fa5&q=${this.getAttribute("value")}&limit=10&offset=0&rating=PG-13&lang=en`,
                method: "GET"
            }).then(function (response) {

                if (response.meta.status == 200) {

                    // Clear any previously displayed GIFS
                    $("#displayedGIFs").empty()

                    response.data.forEach(function (gifObject) {

                        // Append results to displayed GIFS with still images shown by default
                        let stillUrl = gifObject.images.fixed_height_still.url
                        let animateUrl = gifObject.images.fixed_height.url
                        $("#displayedGIFs").append($(`<div class="gifDiv"><img src=${stillUrl} data-state="still" data-animate=${animateUrl} data-still=${stillUrl} alt=${gifObject.title} class="gif"><p>${gifObject.rating}</p></div>`))
                    })

                } else {
                    alert("Gif search failed: " + response.meta.message)
                }
            })
        })

        // Grabbed this code from the pausing GIFs activity ;)
        $(document.body).on("click", ".gif", function () {
            // The attr jQuery method allows us to get or set the value of any attribute on our HTML element
            var state = $(this).attr("data-state");
            // If the clicked image's state is still, update its src attribute to what its data-animate value is.
            // Then, set the image's data-state to animate
            // Else set src to the data-still value
            if (state === "still") {
                $(this).attr("src", $(this).attr("data-animate"));
                $(this).attr("data-state", "animate");
            } else {
                $(this).attr("src", $(this).attr("data-still"));
                $(this).attr("data-state", "still");
            }
        });

        // Handler to add a new topic
        $(document.body).on("click", ".submitButton", function (event) {

            event.preventDefault()

            let topic = $("#addGifTopic").val()
            // Make sure submission is not empty or already in array to prevent duplicate buttons
            if (topic && !topics.includes(topic)) {

                topics.push(topic)
                displayTopicButtons()
            }
        })


    </script>
</body>

</html>